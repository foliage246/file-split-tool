# 檔案切分工具 - 產品設計需求書 (PDR)

## 1. 產品概述

### 產品名稱
檔案切分工具 (File Split Tool)

### 產品描述
一個極簡的網頁工具，專門解決按單一欄位切分檔案的需求。用戶上傳 Excel、CSV、TXT 檔案，選擇一個欄位，系統自動按該欄位的不同值切分成多個檔案並打包下載。

### 目標用戶
- HR 人員（按部門切分員工資料）
- 銷售人員（按地區切分客戶名單）
- 數據分析師（按類別切分數據）
- 行政人員（按月份/類別切分記錄）

## 2. 核心功能需求

### 2.1 檔案上傳
- **支援格式**: 
  - 免費版：CSV (.csv)
  - 付費版：Excel (.xlsx, .xls), CSV (.csv), TXT (.txt)
- **檔案大小限制**: 
  - 免費版：最大 10MB
  - 付費版：最大 100MB
- **上傳方式**: 拖拽上傳或點擊選擇
- **檔案驗證**: 格式驗證、大小檢查、內容預覽

### 2.2 切分設定
- **切分邏輯**: 僅支援按單一欄位值切分
- **欄位選擇**: 自動檢測並顯示所有可用欄位
- **切分預覽**: 顯示將產生的檔案數量和名稱
- **基本設定**: 
  - 保留標題行（預設開啟）
  - 跳過空值（預設開啟）
  - 自動檔案命名

### 2.3 處理與下載
- **順序處理**: 單檔案順序處理，確保穩定性
- **進度顯示**: 即時處理進度
- **結果展示**: 顯示生成檔案清單和統計
- **自動打包**: ZIP 壓縮所有切分檔案
- **一鍵下載**: 直接下載壓縮檔

### 2.4 使用限制
- **免費版限制**:
  - 每日處理次數：5次
  - 檔案大小：10MB
  - 格式支援：僅 CSV
- **付費版權限**:
  - 每日處理次數：50次
  - 檔案大小：100MB
  - 完整格式支援：CSV + Excel + TXT

## 3. 商業模式

### 3.1 免費增值模式 (Freemium)

#### 免費版功能
- 檔案大小：最大 10MB
- 每日處理次數：5次
- 支援格式：僅 CSV
- 基本切分功能：按單一欄位值切分

#### 付費版功能 ($9.99/月)
- 檔案大小：最大 100MB
- 每日處理次數：50次
- 完整格式支援：CSV + Excel + TXT
- 優先處理隊列
- 無廣告體驗

### 3.2 付費系統
- **支付處理**: Stripe 訂閱服務
- **計費週期**: 月付制
- **自動續費**: 支援自動續費和取消
- **退款政策**: 7天無條件退款

### 3.3 收入預測
- **目標轉換率**: 免費用戶到付費用戶 3-5%
- **目標用戶數**: 1000-5000 付費用戶（第一年）
- **預期月收入**: $10,000-50,000

## 4. 技術需求

### 4.1 前端技術棧
- **框架**: React.js 18
- **語言**: TypeScript
- **UI 庫**: Material-UI v5
- **狀態管理**: React Context + useReducer
- **檔案上傳**: react-dropzone
- **建置工具**: Vite

### 4.2 後端技術棧
- **框架**: FastAPI
- **語言**: Python 3.11+
- **檔案處理**: 
  - Excel: openpyxl
  - CSV: pandas
  - TXT: 內建處理
- **壓縮**: zipfile
- **快取**: Redis
- **付費處理**: Stripe Python SDK

### 4.3 基礎設施
- **容器化**: Docker + Docker Compose
- **網頁伺服器**: Nginx
- **資料庫**: Redis（用戶會話和用量追蹤）
- **部署**: 單一伺服器部署（初期）

## 5. 非功能需求

### 5.1 性能需求
- **檔案處理速度**: 順序處理，確保穩定性
- **並發處理**: 單檔案順序處理（簡化架構）
- **響應時間**: 頁面載入 < 2秒
- **可用性**: 99% 正常運行時間

### 5.2 安全需求
- **檔案安全**: 處理後自動刪除（1小時）
- **隱私保護**: 不保存檔案內容
- **付費安全**: Stripe 處理所有敏感付費資訊
- **用量控制**: 嚴格的使用次數和檔案大小限制

### 5.3 易用性需求
- **極簡操作**: 3步驟完成（上傳→選擇→下載）
- **清晰提示**: 明確的免費/付費功能區分
- **錯誤處理**: 友善的錯誤訊息和解決建議

## 6. 用戶流程

### 6.1 核心用戶流程（3步驟）
1. **上傳檔案**: 拖拽或選擇檔案，系統自動驗證
2. **選擇欄位**: 從下拉選單選擇切分欄位，預覽結果
3. **下載結果**: 系統處理完成後下載 ZIP 檔案

### 6.2 付費升級流程
1. **觸發升級**: 超出免費版限制時顯示升級提示
2. **選擇付費**: 點擊升級按鈕
3. **Stripe 付費**: 跳轉到 Stripe 安全付費頁面
4. **付費完成**: 自動跳回網站，功能立即解鎖

### 6.3 異常處理
- **檔案超出限制**: 提示升級到付費版
- **使用次數用完**: 提示明日再試或升級
- **檔案格式不支援**: 清晰說明支援格式
- **處理失敗**: 提供重試選項和技術支援聯絡

## 7. 界面設計原則

### 7.1 設計理念
- **極簡主義**: 只顯示必要資訊
- **直觀操作**: 無需學習即可使用
- **清晰區分**: 明確標示免費/付費功能
- **即時回饋**: 每個操作都有立即反應

### 7.2 關鍵界面
1. **首頁**: 檔案上傳區 + 產品說明
2. **處理頁面**: 欄位選擇 + 預覽 + 處理進度
3. **結果頁面**: 下載按鈕 + 檔案統計
4. **升級頁面**: 付費功能對比 + Stripe 整合
5. **帳戶頁面**: 訂閱狀態 + 使用統計

## 8. 數據模型

### 8.1 用戶模型
```python
User {
  id: string
  email: string
  created_at: datetime
  
  # 訂閱相關
  stripe_customer_id: Optional[string]
  subscription_id: Optional[string]
  is_premium: boolean
  subscription_status: 'active' | 'canceled' | 'past_due'
  premium_expires_at: Optional[datetime]
  
  # 使用統計
  daily_usage_count: number
  last_usage_date: date
}
```

### 8.2 處理任務模型
```python
SplitTask {
  id: string
  user_id: string
  filename: string
  file_size: number
  split_column: string
  status: 'processing' | 'completed' | 'error'
  result_files: string[]  # 生成的檔案名稱列表
  zip_path: string
  created_at: datetime
  expires_at: datetime  # 1小時後自動清理
}
```

### 8.3 使用記錄模型
```python
UsageRecord {
  user_id: string
  date: date
  processing_count: number
  total_file_size: number
}
```

## 9. 風險評估與控制

### 9.1 技術風險
- **檔案處理失敗**: 嚴格的格式驗證和錯誤處理
- **服務器負載**: 單檔案處理 + 嚴格用量限制
- **付費系統故障**: Stripe 提供高可靠性保障

### 9.2 商業風險
- **轉換率過低**: 設定合理的免費版限制來推動升級
- **用戶流失**: 提供優質的用戶體驗和客戶支援
- **競爭壓力**: 專注於簡潔性和易用性的差異化

### 9.3 合規風險
- **數據隱私**: 不保存用戶檔案內容，僅處理
- **付費合規**: 使用 Stripe 確保 PCI 合規性
- **用戶權益**: 清晰的服務條款和退款政策

## 10. 開發與發布計劃

### 10.1 開發階段（總計 5 週）
- **第一階段** (2週): 後端核心功能 + Stripe 基礎整合
- **第二階段** (2週): 前端應用 + 付費界面
- **第三階段** (1週): 整合測試 + 部署上線

### 10.2 MVP 功能範圍
- CSV 檔案單一欄位切分（免費版）
- 基本的 Stripe 付費升級流程
- 用量限制和驗證系統
- 簡潔的 3 步驟用戶界面

### 10.3 後續迭代
- **v1.1**: Excel 和 TXT 格式支援
- **v1.2**: 用戶體驗優化和性能提升
- **v1.3**: 客戶支援工具和分析面板

## 11. 成功指標

### 11.1 技術指標
- 檔案處理成功率 > 95%
- 平均處理時間 < 60秒（100MB檔案）
- 系統可用性 > 99%
- 付費流程成功率 > 98%

### 11.2 商業指標
- 免費到付費轉換率 > 3%
- 付費用戶月流失率 < 5%
- 客戶支援請求 < 10%
- 月收入成長率 > 20%

### 11.3 用戶體驗指標
- 用戶操作完成率 > 85%
- 平均會話時長 < 5分鐘
- 用戶滿意度評分 > 4.2/5.0

---

## 附錄

### A. 支援的檔案格式
**免費版:**
- CSV: .csv (UTF-8 編碼)

**付費版:**
- Excel: .xlsx (首選), .xls
- CSV: .csv (UTF-8, Big5 編碼)
- TXT: .txt (TAB 或逗號分隔)

### B. 切分邏輯說明
- **唯一切分方式**: 按單一欄位值切分
- **處理邏輯**: 根據指定欄位的唯一值分別建立檔案
- **命名規則**: 欄位名_欄位值.原格式
- **空值處理**: 自動跳過空值記錄

### C. 錯誤碼定義
- E001: 檔案格式不支援（提示升級）
- E002: 檔案大小超過限制（提示升級）
- E003: 每日使用次數已滿（提示升級或明日再試）
- E004: 檔案內容解析失敗
- E005: 選定欄位不存在或無效
- E006: 付費驗證失敗

### D. Stripe 付費相關
- **支援付費方式**: 信用卡、借記卡
- **計費貨幣**: USD
- **退款政策**: 7天內無條件退款
- **安全保障**: Stripe PCI Level 1 認證